<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='favicon.png') }}">
    <link rel="apple-touch-icon" href="{{ url_for('static', filename='favicon.png') }}">
    <meta name="apple-mobile-web-app-title" content="GlobalVideo">
    <meta name="description" content="An Audio and Video Converter For Over 1000 Sites Powered By yt-dlp. Turn a link into an MP4, MP3 and more today on GlobalVideo.">
    <script data-goatcounter="https://globalvideo.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>
    <title>GlobalVideo</title>
    <style>
        :root { 
            --primary-bg: #ff4d4d; --primary-hover: #e63939; --primary-text: #ffffff;
            --kofi: #FF5E5B; --bg-color: #f4f1ea; --surface: #ffffff;
            --text-main: #111111; --text-sub: #666666; --border: #dddddd;
            --bg-img: url("{{ url_for('static', filename='background.png') }}");
        }
        body.dark-mode {
            --bg-color: #121212; --surface: #1e1e1e; --text-main: #f0f0f0;
            --text-sub: #aaaaaa; --border: #333333; --primary-bg: #cc0000;
            --primary-hover: #b30000; --bg-img: url("{{ url_for('static', filename='dark_background.png') }}");
        }
        body { 
            background: var(--bg-color) var(--bg-img) repeat; color: var(--text-main);
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "Segoe UI", Roboto, Helvetica, Arial, sans-serif; 
            margin: 0; padding-top: 85px; padding-bottom: 60px; transition: background-color 0.3s, color 0.3s;
        }
        
        .navbar { position: fixed; top: 0; left: 0; width: 100%; height: 65px; background: var(--surface); display: flex; align-items: center; justify-content: center; z-index: 3000; box-shadow: 0 2px 10px rgba(0,0,0,0.05); border-bottom: 1px solid var(--border); transition: background-color 0.3s; }
        .nav-inner { width: 100%; max-width: 1200px; display: flex; align-items: center; justify-content: space-between; padding: 0 20px; height: 100%; box-sizing: border-box; }
        .nav-left { display: flex; align-items: center; }
        .nav-logo { display: flex; align-items: center; gap: 8px; text-decoration: none; color: var(--text-main); font-weight: 800; font-size: 1.4rem; letter-spacing: -0.5px; }
        .nav-logo img { height: 35px; border-radius: 6px; }
        .nav-links { display: flex; align-items: center; gap: 20px; margin-left: 35px; transform: translateY(2px); }
        .nav-links a { color: var(--text-sub); text-decoration: none; font-weight: 600; font-size: 0.95rem; }
        .nav-links a:hover { color: var(--primary-bg); }
        .nav-right { display: flex; align-items: center; gap: 15px; }
        .theme-toggle { font-size: 1.3rem; cursor: pointer; user-select: none; }

        .gtranslate_wrapper select { padding: 0 25px 0 15px !important; border-radius: 12px !important; height: 40px !important; width: auto !important; min-width: 130px !important; box-sizing: border-box !important; font-family: inherit !important; font-weight: 600 !important; font-size: 0.95rem !important; border: 1px solid var(--border) !important; background-color: var(--surface) !important; color: var(--text-main) !important; cursor: pointer !important; outline: none !important; }

        .container { max-width: 900px; margin: 0 auto; padding: 10px 20px 20px; text-align: center; }
        h1 { font-size: 3rem; font-weight: 700; margin-bottom: 5px; margin-top: 0; letter-spacing: -1px; }
        .subtitle { color: var(--text-sub); font-size: 1.25rem; font-weight: 600; margin-top: 0; margin-bottom: 40px; line-height: 1.6; }
        
        form { width: 100%; max-width: 700px; margin: 0 auto 40px; display: flex; flex-direction: column; gap: 12px; }
        
        .input-row { display: flex; width: 100%; height: 65px; border-radius: 12px; overflow: hidden; border: 1px solid var(--border); box-shadow: 0 4px 15px rgba(0,0,0,0.03); box-sizing: border-box; background: var(--surface); }
        .input-container { display: flex; align-items: center; position: relative; flex-grow: 1; height: 100%; }
        input { width: 100%; height: 100%; padding: 0 45px 0 22px; border: none; outline: none; font-family: inherit; font-size: 1.15rem; font-weight: 500; background: transparent; color: var(--text-main); box-sizing: border-box; }
        .batch-btn { position: absolute; right: 15px; height: 28px; width: 28px; cursor: pointer; opacity: 0.7; transition: opacity 0.2s; }
        .batch-btn:hover { opacity: 1; }
        
        .codec-select { width: 38%; height: 100%; border: none; border-left: 1px solid var(--border); background: transparent; color: var(--text-main); padding: 0 22px; font-family: inherit; font-weight: 600; cursor: pointer; outline: none; font-size: 0.95rem; text-align: left; box-sizing: border-box; }
        
        .action-row { display: flex; width: 100%; height: 65px; border-radius: 12px; overflow: hidden; border: 1px solid var(--border); box-shadow: 0 4px 15px rgba(0,0,0,0.03); box-sizing: border-box; }
        
        .format-select { width: 38%; height: 100%; border: none; background: var(--surface); color: var(--text-main); padding: 0 22px; font-family: inherit; font-weight: 600; cursor: pointer; border-right: 1px solid var(--border); outline: none; font-size: 0.95rem; text-align: left; box-sizing: border-box; }
        
        .dl-btn { width: 62%; height: 100%; background: var(--primary-bg); color: var(--primary-text); border: none; font-weight: 700; cursor: pointer; font-size: 1.15rem; letter-spacing: 0.5px; transition: background-color 0.2s; box-sizing: border-box; }
        .dl-btn:hover { background: var(--primary-hover); }

        .kofi-bar { display: flex; align-items: center; justify-content: center; gap: 15px; background: var(--surface); border: 2px solid var(--border); border-radius: 100px; padding: 10px 25px; width: fit-content; margin: 0 auto 40px; box-shadow: 0 5px 15px rgba(0,0,0,0.04); transition: transform 0.2s; text-decoration: none; box-sizing: border-box; }
        .kofi-bar:hover { transform: translateY(-2px); border-color: var(--kofi); }
        .kofi-cup { height: 35px; width: auto; }
        .kofi-text { font-weight: 700; font-size: 1.3rem; color: var(--text-main); margin: 0; white-space: nowrap; }
        .kofi-qr { height: 75px; width: 75px; border-radius: 10px; }

        .seo-section { max-width: 800px; margin: 0 auto; text-align: left; background: var(--surface); padding: 45px; border-radius: 16px; border: 1px solid var(--border); box-shadow: 0 10px 30px rgba(0,0,0,0.03); line-height: 1.7; }
        .seo-section h2 { font-size: 2rem; font-weight: 800; margin-top: 0; margin-bottom: 20px; letter-spacing: -0.5px; color: var(--text-main); }
        .seo-section h3 { font-size: 1.4rem; font-weight: 700; margin-top: 35px; margin-bottom: 15px; color: var(--text-main); }
        .seo-section p { font-size: 1.05rem; color: var(--text-sub); margin-bottom: 15px; }
        .seo-section ul, .seo-section ol { padding-left: 20px; color: var(--text-sub); font-size: 1.05rem; margin-bottom: 20px; line-height: 1.6; }
        .seo-section li { margin-bottom: 8px; }
        .seo-section a { color: var(--primary-bg); text-decoration: none; font-weight: 600; }
        .seo-section a:hover { text-decoration: underline; }

        #loader { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(244, 241, 234, 0.95); z-index: 4000; flex-direction: column; align-items: center; justify-content: center; backdrop-filter: blur(5px); }
        body.dark-mode #loader { background: rgba(18, 18, 18, 0.95); }
        #loader h2 { font-weight: 800; font-size: 2.2rem; color: var(--text-main); letter-spacing: 1px; margin-bottom: 10px; text-align: center; }
        #loader h3 { font-weight: 600; font-size: 1.2rem; color: var(--primary-bg); text-align: center; margin-top: 0; margin-bottom: 20px; max-width: 80%; word-wrap: break-word; }
        .progress-container { width: 80%; max-width: 400px; height: 12px; background: var(--border); border-radius: 10px; overflow: hidden; box-shadow: inset 0 1px 3px rgba(0,0,0,0.1); }
        .progress-fill { height: 100%; width: 0%; background: var(--primary-bg); border-radius: 10px; transition: width 0.2s ease-out; }
        .progress-text { margin-top: 15px; font-weight: 700; font-size: 1.2rem; color: var(--text-main); font-variant-numeric: tabular-nums; }

        @media (max-width: 768px) {
            h1 { font-size: 1.8rem; }
            .subtitle { font-size: 1rem; }
            .nav-inner { flex-direction: column; align-items: center; padding: 15px 20px; height: auto; }
            .nav-left { flex-direction: column; align-items: center; }
            .nav-links { margin-left: 0; justify-content: center; flex-wrap: wrap; margin-top: 10px; transform: none; }
            .nav-right { width: 100%; display: center; justify-content: center; gap: 15px; margin-top: 15px; }
            .navbar { height: auto; padding-bottom: 15px; }
            body { padding-top: 180px; }
            
            .input-row { flex-direction: column; height: auto; border: none; box-shadow: none; background: transparent; gap: 12px; }
            .input-container { width: 100%; height: 60px; border: 1px solid var(--border); border-radius: 12px; background: var(--surface); }
            
            .action-row { flex-direction: column; height: auto; border: none; box-shadow: none; gap: 12px; }
            
            /* MOBILE UI FIX: Groups Codec and Format perfectly together with identical 22px padding */
            .codec-select, .format-select { width: 100%; height: 60px; border: 1px solid var(--border); border-radius: 12px; padding: 0 22px; background: var(--surface); box-sizing: border-box; }
            
            .dl-btn { width: 100%; height: 60px; border-radius: 12px; border: none; }
            .seo-section { padding: 30px 20px; border-radius: 12px; }
        }
    </style>
</head>
<body>
    <script>if (localStorage.getItem('theme') === 'dark') document.body.classList.add('dark-mode');</script>

    <nav class="navbar">
        <div class="nav-inner">
            <div class="nav-left">
                <a href="/" class="nav-logo">
                    <img src="{{ url_for('static', filename='favicon.png') }}" alt="Logo">
                    <span>GlobalVideo</span>
                </a>
                <div class="nav-links">
                    <a href="/">Main</a>
                    <a href="https://ko-fi.com/globalvideo" target="_blank">Donations</a>
                    <a href="https://tally.so/r/gD05AN" target="_blank">Feedback</a>
                    <a href="/legal">Legal</a>
                </div>
            </div>
            <div class="nav-right">
                <span class="theme-toggle" id="theme-toggle">&#x2600;&#xFE0F;</span>
                <div class="gtranslate_wrapper"></div>
                <script>window.gtranslateSettings = {"default_language":"en","native_language_names":true,"languages":["en","es","fr","de","it","pt","ru","zh-CN","ja","ko","ar","hi"],"wrapper_selector":".gtranslate_wrapper","flag_style":"2d"}</script>
                <script src="https://cdn.gtranslate.net/widgets/latest/dropdown.js" defer></script>
            </div>
        </div>
    </nav>

    <div class="container">
        <h1>A Free Media Link to File Converter</h1>
        <p class="subtitle">GlobalVideo is an Audio/Video File Converter for Over 1000 Sites with no Sign-Ups and No Ads</p>
        
        <form id="dl-form" action="/download" method="POST">
            <input type="file" id="batch-file-input" accept=".txt" style="display: none;">
            
            <div class="input-row">
                <div class="input-container">
                    <input type="text" name="url" id="url-input" placeholder="Paste link or playlist here..." required autocomplete="off">
                    <img src="{{ url_for('static', filename='batch_icon.png') }}" 
                         data-light="{{ url_for('static', filename='batch_icon.png') }}"
                         data-dark="{{ url_for('static', filename='batch_icon_dark.png') }}"
                         id="batch-trigger" class="batch-btn" alt="Batch Download" title="Upload a .txt file with links">
                </div>
                <select name="codec" id="codec-select" class="codec-select">
                    <optgroup label="Codec">
                        <option value="h264">H.264 (High Compatibility)</option>
                        <option value="av1">AV1 (Small File Size)</option>
                    </optgroup>
                </select>
            </div>
            <div class="action-row">
                <select name="format" id="format-select" class="format-select">
                    <optgroup label="Video">
                        <option value="mp4_2160">MP4 (4K)</option>
                        <option value="mp4_1440">MP4 (1440p)</option>
                        <option value="mp4_1080" selected>MP4 (1080p)</option>
                        <option value="mp4_720">MP4 (720p)</option>
                        <option value="mp4_480">MP4 (480p)</option>
                        <option value="direct_video">Direct Rip (Original Quality)</option>
                    </optgroup>
                    <optgroup label="Audio">
                        <option value="mp3_320">MP3 (320kbps)</option>
                        <option value="mp3_192">MP3 (192kbps)</option>
                        <option value="wav">WAV (Source Dependent Lossless)</option>
                        <option value="flac">FLAC (Source Dependent Lossless)</option>
                        <option value="best_audio">Direct Rip (Original Quality)</option>
                    </optgroup>
                </select>
                <button type="submit" class="dl-btn">Download</button>
            </div>
        </form>

        <a href="https://ko-fi.com/globalvideo" target="_blank" class="kofi-bar">
            <img src="{{ url_for('static', filename='kofi_logo.png') }}" class="kofi-cup" alt="Ko-fi">
            <span class="kofi-text">Support on <span style="color: var(--kofi);">Ko-fi</span></span>
            <img src="{{ url_for('static', filename='kofi_qr.png') }}" class="kofi-qr" alt="QR">
        </a>

        <div class="seo-section">
            <h2>The Safest Free Video Link to File Converter</h2>
            <p>Have you ever tried to convert a link to a video or audio file, only to be bombarded by shady pop-up ads, viruses, or poor-quality exports? GlobalVideo fixes that. We provide a clean, fast, and completely ad-free way to save your favorite content. There are no sign-ups, no hidden restrictions, and absolutely no catches.</p>
            
            <h3>Download From 1,000+ Websites</h3>
            <p>GlobalVideo.download is a web interface powered by yt-dlp, meaning it supports over 1,000 websites. Whether you need to save a video for a project, back up your own content, or download audio for offline listening, our tool leaves you with a universally compatible file. Notable supported sites include YouTube, TikTok, Twitter (X), Instagram, Twitch, and Reddit. <a href="https://github.com/yt-dlp/yt-dlp/blob/master/supportedsites.md" target="_blank">View the full list here.</a></p>
            
            <h3>Pro Quality & Lossless Support</h3>
            <p>We believe in quality. GlobalVideo supports high-fidelity audio extraction and high-resolution video merging. <strong>Note on Lossless:</strong> While we offer FLAC and WAV, these formats are only truly lossless if the source link provides high-quality data (e.g., Bandcamp or SoundCloud high-fidelity streams). "Direct Rip" options preserve the original source codec exactly as it is stored on the remote server.</p>
            
            <h3>How It Works</h3>
            <p>Our process is designed to remove frustration and give students, content creators, and casual viewers exactly what they need without delay. It works in three simple steps:</p>
            <ol>
                <li><strong>Copy the link</strong> of the video or audio you want to save from any supported site.</li>
                <li><strong>Paste the link</strong> into the search bar above.</li>
                <li><strong>Choose your format</strong> and quality, then hit Download!</li>
            </ol>
            <p>Within seconds, your file is ready to save to your personal archive. It operates entirely on our secure server - no software installation required.</p>
        </div>
    </div>

    <div id="loader">
        <h2 id="loader-title">PROCESSING...</h2>
        <h3 id="loader-error" style="display: none;"></h3>
        <div class="progress-container">
            <div class="progress-fill" id="progress-fill"></div>
        </div>
        <div class="progress-text" id="progress-text">0%</div>
    </div>

    <script type="text/javascript">
        document.addEventListener('DOMContentLoaded', () => {
            const urlInput = document.getElementById('url-input');
            const formatSelect = document.getElementById('format-select');
            const codecSelect = document.getElementById('codec-select');
            const dlForm = document.getElementById('dl-form');
            const themeToggle = document.getElementById('theme-toggle');
            const batchIcon = document.getElementById('batch-trigger');
            const bodyTheme = document.body;
            
            let downloadQueue = [];
            let isBatchProcessing = false;

            if (bodyTheme.classList.contains('dark-mode')) {
                themeToggle.innerHTML = '&#x1F319;';
                batchIcon.src = batchIcon.getAttribute('data-dark');
            } else {
                themeToggle.innerHTML = '&#x2600;&#xFE0F;';
            }

            themeToggle.addEventListener('click', () => {
                bodyTheme.classList.toggle('dark-mode');
                const isDark = bodyTheme.classList.contains('dark-mode');
                
                themeToggle.innerHTML = isDark ? '&#x1F319;' : '&#x2600;&#xFE0F;';
                batchIcon.src = isDark ? batchIcon.getAttribute('data-dark') : batchIcon.getAttribute('data-light');
                
                localStorage.setItem('theme', isDark ? 'dark' : 'light');
            });

            function toggleCodecState() {
                if(formatSelect.value.includes('mp3') || formatSelect.value.includes('wav') || formatSelect.value.includes('flac') || formatSelect.value.includes('best_audio') || formatSelect.value === 'direct_video') {
                    codecSelect.disabled = true; codecSelect.style.opacity = '0.5';
                } else {
                    codecSelect.disabled = false; codecSelect.style.opacity = '1';
                }
            }
            formatSelect.addEventListener('change', toggleCodecState);
            toggleCodecState(); 

            const batchTrigger = document.getElementById('batch-trigger');
            const batchInput = document.getElementById('batch-file-input');
            
            batchTrigger.addEventListener('click', () => batchInput.click());

            batchInput.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if(!file) return;
                const reader = new FileReader();
                reader.onload = function(evt) {
                    const lines = evt.target.result.split('\n').map(l => l.trim());
                    const links = lines.filter(l => l.startsWith('http://') || l.startsWith('https://'));
                    
                    if(links.length > 0) {
                        downloadQueue = links;
                        processNextInQueue();
                    } else {
                        alert("No valid links (http:// or https://) found in this file.");
                    }
                };
                reader.readAsText(file);
                batchInput.value = ''; 
            });

            async function executeDownload(targetUrl) {
                const loader = document.getElementById('loader');
                const progBar = document.getElementById('progress-fill');
                const progText = document.getElementById('progress-text');
                const loaderTitle = document.getElementById('loader-title');
                const loaderError = document.getElementById('loader-error');
                
                loaderError.style.display = 'none';

                if (isBatchProcessing) {
                    loaderTitle.innerText = `PROCESSING BATCH (${downloadQueue.length} remaining)...`;
                } else {
                    loaderTitle.innerText = "PROCESSING...";
                }

                loader.style.display = 'flex';
                progBar.style.width = '0%';
                progText.innerText = '0%';
                
                let progress = 0;
                let isDownloading = true;

                function updateProgress() {
                    if (!isDownloading || progress >= 98) return;
                    let delay = Math.random() * 1500 + 500;
                    let increment = progress < 15 ? Math.random() * 10 + 5 : progress < 60 ? Math.random() * 12 + 2 : progress < 85 ? Math.random() * 4 + 1 : Math.random() * 1.5 + 0.1;
                    if (Math.random() > 0.8) { increment = 0; delay += 1200; }
                    progress = Math.min(progress + increment, 98);
                    progBar.style.width = progress + '%';
                    progText.innerText = Math.floor(progress) + '%';
                    setTimeout(updateProgress, delay);
                }
                updateProgress();

                try {
                    const formData = new FormData();
                    formData.append('url', targetUrl);
                    formData.append('format', formatSelect.value);
                    formData.append('codec', codecSelect.value);
                    formData.append('ajax', 'true'); 
                    formData.append('is_batch', isBatchProcessing ? 'true' : 'false'); 

                    const response = await fetch('/download', { method: 'POST', body: formData });

                    if (response.ok) {
                        const data = await response.json();
                        if (data.status === 'success') {
                            
                            const iframe = document.createElement('iframe');
                            iframe.style.display = 'none';
                            iframe.src = `/file/${encodeURIComponent(data.file)}?name=${encodeURIComponent(data.safe_name)}`;
                            document.body.appendChild(iframe);
                            setTimeout(() => { document.body.removeChild(iframe); }, 10000);

                            isDownloading = false;
                            progBar.style.width = '100%';
                            progText.innerText = '100%';
                            
                            return true;
                        }
                    } else {
                        let errorMsg = await response.text();
                        errorMsg = errorMsg.replace(/(<([^>]+)>)/gi, ""); 
                        
                        isDownloading = false;
                        progBar.style.width = '100%';
                        progText.innerText = 'ERROR';
                        progBar.style.background = '#333333';
                        
                        loaderTitle.innerText = "FAILED TO PROCESS LINK";
                        loaderError.innerText = errorMsg.substring(0, 150);
                        loaderError.style.display = 'block';

                        await new Promise(r => setTimeout(r, 4000)); 
                        
                        progBar.style.background = 'var(--primary-bg)';
                        loaderError.style.display = 'none';
                        return false;
                    }
                } catch (error) {
                    isDownloading = false;
                    progBar.style.width = '100%';
                    progText.innerText = 'ERROR';
                    progBar.style.background = '#333333';
                    
                    loaderTitle.innerText = "NETWORK TIMEOUT";
                    loaderError.innerText = "The connection to the server was lost.";
                    loaderError.style.display = 'block';

                    await new Promise(r => setTimeout(r, 4000)); 
                    
                    progBar.style.background = 'var(--primary-bg)';
                    loaderError.style.display = 'none';
                    return false;
                }
            }

            async function processNextInQueue() {
                if (downloadQueue.length === 0) {
                    document.getElementById('loader').style.display = 'none';
                    if(isBatchProcessing) {
                        isBatchProcessing = false;
                        urlInput.value = "";
                    }
                    return;
                }

                isBatchProcessing = true;
                const nextUrl = downloadQueue.shift();
                urlInput.value = nextUrl; 

                await executeDownload(nextUrl);

                setTimeout(() => {
                    document.getElementById('progress-fill').style.width = '0%';
                    document.getElementById('progress-text').innerText = '0%';
                    processNextInQueue();
                }, 1500);
            }

            dlForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                const rawUrl = urlInput.value.trim();
                
                const isPlaylistOrChannel = rawUrl.includes('list=') || rawUrl.includes('playlist') || rawUrl.includes('/@') || rawUrl.includes('/channel/') || rawUrl.includes('/c/') || rawUrl.includes('/user/');
                
                if(isPlaylistOrChannel) {
                    document.getElementById('loader').style.display = 'flex';
                    document.getElementById('loader-title').innerText = "EXTRACTING PLAYLIST/CHANNEL...";
                    document.getElementById('loader-error').style.display = 'none';
                    
                    const fd = new FormData();
                    fd.append('url', rawUrl);
                    
                    try {
                        const res = await fetch('/api/extract_playlist', { method: 'POST', body: fd });
                        const data = await res.json();
                        
                        if (data.is_playlist && data.urls.length > 0) {
                            downloadQueue = data.urls;
                            processNextInQueue();
                            return;
                        }
                    } catch(e) {
                        console.error("Extraction failed, falling back to normal.", e);
                    }
                }

                downloadQueue = [rawUrl];
                processNextInQueue();
            });
        });
    </script>
</body>
</html>
